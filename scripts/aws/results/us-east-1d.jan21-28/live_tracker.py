import datetime
import json

'''
sample_dict = {"i-03e566005ce6096f7": [["k80", 1], "2022-01-22T17:01:29.000Z", "2022-01-22T17:50:58.000Z"], "i-03dfabd6ab2fe1211": [["k80", 1], "2022-01-22T17:07:56.000Z", "2022-01-22T18:41:38.000Z"], "i-0a38568da603a6b15": [["k80", 1], "2022-01-22T17:19:36.000Z", "2022-01-22T17:56:35.000Z"], "i-03ce24b9c085ec5cf": [["k80", 1], "2022-01-22T17:26:03.000Z", -1]}
'''
'''
sample_dict={"i-03e566005ce6096f7": [["k80", 1], "2022-01-22T17:01:29.000Z", "2022-01-22T17:50:58.000Z"], "i-03dfabd6ab2fe1211": [["k80", 1], "2022-01-22T17:07:56.000Z", "2022-01-22T18:41:38.000Z"], "i-0a38568da603a6b15": [["k80", 1], "2022-01-22T17:19:36.000Z", "2022-01-22T17:56:35.000Z"], "i-03ce24b9c085ec5cf": [["k80", 1], "2022-01-22T17:26:03.000Z", "2022-01-22T17:37:47.000Z"], "i-0d055f780bdd121ac": [["k80", 1], "2022-01-22T17:27:37.000Z", "2022-01-22T17:52:46.000Z"], "i-0218696dde519af44": [["k80", 1], "2022-01-22T17:34:24.000Z", "2022-01-22T17:50:26.000Z"], "i-0ae78c59f530eb503": [["k80", 1], "2022-01-22T17:38:18.000Z", "2022-01-22T17:52:14.000Z"], "i-070fd127ee08d17df": [["k80", 1], "2022-01-22T17:40:56.000Z", "2022-01-22T17:49:23.000Z"], "i-08cf05c238089df43": [["k80", 1], "2022-01-22T17:41:27.000Z", "2022-01-22T17:47:00.000Z"], "i-0c7f1d09dc2a860a0": [["k80", 1], "2022-01-22T17:43:46.000Z", "2022-01-22T17:57:39.000Z"], "i-01944886937e93637": [["k80", 1], "2022-01-22T18:24:06.000Z", "2022-01-22T18:35:46.000Z"], "i-06d965adb24c15718": [["k80", 1], "2022-01-23T00:20:35.000Z", "2022-01-23T01:41:06.000Z"], "i-0b683e58773de6f1c": [["k80", 1], "2022-01-23T00:21:06.000Z", "2022-01-23T01:41:38.000Z"], "i-072519cc14809827d": [["k80", 1], "2022-01-23T00:23:11.000Z", "2022-01-23T01:42:42.000Z"], "i-06d16b1e11e1ba0ef": [["k80", 1], "2022-01-23T00:25:26.000Z", "2022-01-23T01:37:21.000Z"], "i-0d42cf1d42ac66c15": [["k80", 1], "2022-01-23T00:26:59.000Z", "2022-01-23T01:38:58.000Z"], "i-0ad02b6884ef152ef": [["k80", 1], "2022-01-23T00:28:02.000Z", "2022-01-23T01:40:02.000Z"], "i-051853d70a0292049": [["k80", 1], "2022-01-23T00:28:33.000Z", "2022-01-23T01:40:34.000Z"], "i-0df19389de9dbbc96": [["k80", 1], "2022-01-23T00:29:06.000Z", "2022-01-23T01:42:10.000Z"], "i-008441e39b1233e5f": [["k80", 1], "2022-01-23T00:29:48.000Z", "2022-01-23T01:36:49.000Z"], "i-02073d110b077f5d2": [["k80", 1], "2022-01-23T00:30:20.000Z", "2022-01-23T01:37:54.000Z"], "i-0dc420c95abb084a2": [["k80", 1], "2022-01-23T00:30:51.000Z", "2022-01-23T01:38:26.000Z"], "i-06e13745f89b63a77": [["k80", 1], "2022-01-23T00:31:23.000Z", "2022-01-23T01:39:30.000Z"], "i-0e4bb008924d7ce41": [["k80", 1], "2022-01-23T02:48:42.000Z", "2022-01-23T03:00:29.000Z"], "i-067cbd86d740873e3": [["k80", 1], "2022-01-23T02:54:34.000Z", "2022-01-23T02:59:56.000Z"], "i-019dc4127e69ba2fd": [["k80", 1], "2022-01-23T02:56:08.000Z", "2022-01-23T03:02:03.000Z"], "i-00eddba6765058380": [["k80", 1], "2022-01-23T02:56:39.000Z", "2022-01-23T03:02:35.000Z"], "i-0d66f9abec58020e5": [["k80", 1], "2022-01-23T03:03:07.000Z", "2022-01-23T03:13:54.000Z"], "i-0892d4268f82165e9": [["k80", 1], "2022-01-23T03:05:11.000Z", "2022-01-23T03:18:05.000Z"], "i-012822f4882c106c4": [["k80", 1], "2022-01-23T03:06:23.000Z", "2022-01-23T03:20:22.000Z"], "i-0d0d17d03b629a889": [["k80", 1], "2022-01-23T03:18:04.000Z", "2022-01-23T03:28:11.000Z"], "i-0b8594cc9a79291ab": [["k80", 1], "2022-01-23T03:21:24.000Z", "2022-01-23T03:30:26.000Z"], "i-096266287f7ed1ae4": [["k80", 1], "2022-01-23T03:23:29.000Z", "2022-01-23T03:31:30.000Z"], "i-0cb534bf934e7583d": [["k80", 1], "2022-01-23T03:37:21.000Z", "2022-01-23T03:57:15.000Z"], "i-093fc099c4d2582d8": [["k80", 1], "2022-01-23T03:39:25.000Z", "2022-01-23T03:49:13.000Z"], "i-09aa4196c106ab4d4": [["k80", 1], "2022-01-23T03:40:58.000Z", "2022-01-23T03:45:52.000Z"], "i-09efc4183ed8180a1": [["k80", 1], "2022-01-23T03:41:29.000Z", "2022-01-23T04:05:37.000Z"], "i-038cb39236614abac": [["k80", 1], "2022-01-23T03:44:16.000Z", "2022-01-23T03:59:21.000Z"], "i-001283e0849ba9cd5": [["k80", 1], "2022-01-23T03:50:46.000Z", "2022-01-23T04:04:34.000Z"], "i-055722acb64b93134": [["k80", 1], "2022-01-23T05:02:30.000Z", "2022-01-23T05:08:23.000Z"], "i-04497485c92bf4cab": [["k80", 1], "2022-01-23T05:04:03.000Z", "2022-01-23T05:14:51.000Z"], "i-0f047ccabc19792db": [["k80", 1], "2022-01-23T05:04:34.000Z", "2022-01-23T05:15:23.000Z"], "i-05cd27580cdb9518c": [["k80", 1], "2022-01-23T05:05:16.000Z", "2022-01-23T05:16:05.000Z"], "i-0e0c58aa41e76b358": [["k80", 1], "2022-01-23T05:06:49.000Z", "2022-01-23T05:11:13.000Z"], "i-07eaf504fdb15c4f3": [["k80", 1], "2022-01-23T05:39:53.000Z", "2022-01-23T05:55:32.000Z"], "i-0367fc06eefbf6203": [["k80", 1], "2022-01-23T05:44:43.000Z", "2022-01-23T06:23:39.000Z"], "i-0096fb7b01473e7d1": [["k80", 1], "2022-01-23T05:48:00.000Z", -1], "i-09fbee9bf61f3edcb": [["k80", 1], "2022-01-23T05:49:03.000Z", "2022-01-23T06:23:05.000Z"], "i-0a2c434332e282d1c": [["k80", 1], "2022-01-23T05:51:41.000Z", "2022-01-23T05:56:04.000Z"], "i-0c99b791a89c2e0ef": [["k80", 1], "2022-01-23T05:52:12.000Z", -1], "i-0ad6db14ff01a8ae4": [["k80", 1], "2022-01-23T05:52:43.000Z", "2022-01-23T06:21:50.000Z"], "i-0e55e0a5918ee4644": [["k80", 1], "2022-01-23T05:55:00.000Z", "2022-01-23T05:58:25.000Z"], "i-04f5a53814d09096c": [["k80", 1], "2022-01-23T06:04:22.000Z", "2022-01-23T06:22:33.000Z"], "i-0fba75c9de85cfc5d": [["k80", 1], "2022-01-23T06:06:28.000Z", -1], "i-04605732fdb25e22d": [["k80", 1], "2022-01-23T06:08:03.000Z", "2022-01-23T06:16:22.000Z"], "i-0ca45e0a463151ca2": [["k80", 1], "2022-01-23T06:09:37.000Z", -1], "i-0f55499d2d812c5b3": [["k80", 1], "2022-01-23T06:11:11.000Z", -1], "i-0902064963c3271cd": [["k80", 1], "2022-01-23T06:13:32.000Z", -1], "i-0052ae3bdff0eb3fb": [["k80", 1], "2022-01-23T06:16:53.000Z", -1], "i-04b408d1abc315062": [["k80", 1], "2022-01-23T06:17:26.000Z", -1], "i-075fba88e384a3cf5": [["k80", 1], "2022-01-23T06:31:31.000Z", -1], "i-0c659d1c4fd67291a": [["k80", 1], "2022-01-23T06:33:07.000Z", -1], "i-055002b228a03d61e": [["k80", 1], "2022-01-23T06:34:47.000Z", -1], "i-0f039b06624aa93ce": [["k80", 1], "2022-01-23T06:36:32.000Z", -1]}
'''
import ast

with open('dict_snapshot') as f:
    dict_data=f.read()

#sample_dict=json.loads(dict_data)
sample_dict = ast.literal_eval(dict_data)

def extract_timestamp(t):
    pos=t.find('T')+1
    timestamp=(t[0:10],t[pos:pos+8]) #format:(date,time)
    #print(timstamp)
    return timestamp


def get_all_timestamps(sample_dict):
    ts_list=[]
    for i in sample_dict:
        ts_list.append((extract_timestamp(sample_dict[i][1]), 1)) #append all start times, +1 to indicate addition
        if sample_dict[i][2]!=-1:
            ts_list.append((extract_timestamp(sample_dict[i][2]), -1)) #append end times if they exist, -1 to indicate revocation


    return ts_list

def convert_to_seconds(timestamp):
    t = timestamp.split(':')
    hours=int(t[0])
    minutes=int(t[1])
    seconds=int(t[2])
    total_seconds = hours*3600+minutes*60+seconds
    return total_seconds


def convert_to_datetime(d):
    dlist=d.split('-')
    date_format=datetime.datetime(int(dlist[0]),int(dlist[1]),int(dlist[2]))
    return date_format

def sort_timestamp_list(ts_list):
    n = len(ts_list)
    for i in range(n-1):
        for j in range(0, n-i-1):
            if convert_to_datetime(ts_list[j][0][0])==convert_to_datetime(ts_list[j+1][0][0]): #Same date, then compare times
                if convert_to_seconds(ts_list[j][0][1]) > convert_to_seconds(ts_list[j + 1][0][1]) :
                    ts_list[j], ts_list[j + 1] = ts_list[j + 1], ts_list[j]
            elif convert_to_datetime(ts_list[j][0][0])>convert_to_datetime(ts_list[j+1][0][0]):
                ts_list[j], ts_list[j + 1] = ts_list[j + 1], ts_list[j]


ts_list = get_all_timestamps(sample_dict)
#print('Before:',ts_list)
sort_timestamp_list(ts_list)
print('After', ts_list)


x_axis = []
y_axis = []

ctr=0 #running counter

for i in ts_list:
    x_axis.append(i[0])
    ctr+=i[1]
    y_axis.append(ctr)

print('x axis:')

for i in x_axis:
    print(i)

print('y axis')
for i in y_axis:
    print(i)





